---
title: Henley Passport Index
date: '2025-09-09'
long_date: 9 September 2025
year: 2025
week: 36
full_width: true
---

{@partial "meta.md"}

This week we're looking at the [Henley Passport Index](https://www.henleyglobal.com/passport-index/about), which scores passports based on their visa-free access to other countries. The provided datasets included both historical scores for each country, as well as visa requirements for each passport country to each destination. Of course, I'm personally really interested in this kind of data, and there were a lot of directions I would've liked to go with it.

In the end, I thought it would be interesting to see the juxtaposition of what kind of access was granted to a given passport next to what that same country required of other passport holders. I also thought the Sankey flow diagram made for an interesting visual representation.

<Details title="Queries">

I was having significant performance issues trying to use live queries from the original CSV; it made a night-and-day difference to generate new CSVs from the transformation queries and then put much simpler dynamic queries on top of those. First, creating a list of countries to populate my dropdown menu:

```sql
copy (
   select distinct country
     from 'https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-09-09/country_lists.csv'
    order by country
) to countries.csv
```

Then unpivoting the visa requirements and unnesting the JSON containing destination countries:

```sql
copy (
  with

  unpivoted as (
    unpivot 'https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-09-09/country_lists.csv'
         on columns(* exclude (code, country))
  into name visa_requirement
      value countries
  ),

  unnested as (
     select country,
            visa_requirement,
            unnest(from_json(countries, '[[{"code":"VARCHAR","name":"VARCHAR"}]]'), recursive := true)

       from unpivoted
  ),

  renamed as (
     select country as passport,
            name as destination,
            case visa_requirement
                 when 'visa_required' then 'Visa Required'
                 when 'visa_online' then 'Online Visa'
                 when 'visa_on_arrival' then 'Visa on Arrival'
                 when 'visa_free_access' then 'Visa-Free Access'
                 when 'electronic_travel_authorisation' then 'Electronic Travel Authorization'
                  end as visa_requirement

       from unnested
  )

  from renamed
) to visa_requirements_unpivoted.csv
```

The final query (and results) to set up the Sankey chart can be shown with the **Show Queries** option in the â€¢â€¢â€¢ menu.

```sql countries
from tidytuesday.countries
```

```sql sankey
 select 'ðŸ›¬ ' || visa_requirement as source,
        destination as target,
        count(*) as count
   from tidytuesday.visa_requirements_unpivoted
  where destination = '${inputs.country.value}'
  group by all

  union all

 select passport as source,
        'ðŸ›« ' || visa_requirement as target,
        count(*) as count
   from tidytuesday.visa_requirements_unpivoted
  where passport = '${inputs.country.value}'
  group by all
```

</Details>

<Dropdown
  data={countries}
  name=country
  value=country
  title=Country
  defaultValue=Afghanistan
/>

<SankeyDiagram
  data={sankey}
  title="Oyster Quotient"
  subtitle="Visa requirements to and from {inputs.country.value}"
  sourceCol=source
  targetCol=target
  valueCol=count
  linkColor=gradient
/>

<Note>
Source: <Link label='Henley Passport Index Data' url='https://api.henleypassportindex.com/api/v3/countries' />
</Note>

The world isnâ€™t *everyone's* oyster.
