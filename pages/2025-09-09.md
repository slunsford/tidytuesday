---
title: Henley Passport Index
date: 2025-09-09
week: 36
---

<Note>
  Week 36 â€¢ 9 September 2025
</Note>

```sql countries
select distinct country, code
  from tidytuesday.country_lists
 order by country
```
<Dropdown
    data={countries}
    name=country
    value=country
    title=Country
    defaultValue=Afghanistan
/>

```sql unpivot_visa_types
with unpivoted as (
    unpivot tidytuesday.country_lists on columns(* exclude (code, country)) into
       name visa_type
      value countries
),

unnested as (
     select country,
            visa_type,
            unnest(from_json(countries, '[[{"code":"VARCHAR","name":"VARCHAR"}]]'), recursive := true)

       from unpivoted
      -- where visa_type like '${inputs.visa_types}'
),

renamed as (
     select country as destination,
            name as passport,
            case visa_type
                 when 'visa_required' then 'Visa Required'
                 when 'visa_online' then 'Online Visa'
                 when 'visa_on_arrival' then 'Visa on Arrival'
                 when 'visa_free_access' then 'Visa-Free Access'
                 when 'electronic_travel_authorisation' then 'ETA'
                  end as visa_type

       from unnested
)

 select visa_type as source,
        destination as target,
        count(*) as count
   from renamed
  where destination = '${inputs.country.value}'
  group by all

  union all

 select passport as source,
        visa_type as target,
        count(*) as count
   from renamed
  where passport = '${inputs.country.value}'
  group by all
```

<SankeyDiagram
    data={unpivot_visa_types}
    title="Sankey"
    subtitle="A simple sankey chart"
    sourceCol=source
    targetCol=target
    valueCol=count
/>
